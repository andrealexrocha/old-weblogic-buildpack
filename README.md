<<<<<<< HEAD
# Cloud Foundry WebLogic Buildpack

The `weblogic-buildpack` is a [Cloud Foundry][] buildpack for running JVM-based web applications on [WebLogic Application Server][].  It is designed to run WebLogic-based web or ear applications with minimal configuration on CloudFoundry.
This buildpack is based on a fork of the [java-buildpack][].

Based on configurations passed with the app bits, a single server WebLogic Domain configuration would get created with the application deployed and executed within the CloudFoundry container as a droplet.

## Requirements
* WebLogic Server and JDK Binaries
   * The WebLogic Server release bits and jdk binaries should be accessible for download over the web (can be internal or public facing) for the buildpack to create the necessary configurations along with the app bits.
     For testing in a [bosh-lite] environment, create a loopback alias on the machine so the ip would be accessible from the DEA container.
   
     Sample script for Mac
	 
     ```#!/bin/sh
        ifconfig lo0 alias 12.1.1.1
     ```

   * Edit the repository_root of [weblogic.yml](config/weblogic.yml) to point to the server hosting the weblogic binary.
   
     Sample `repository_root` for weblogic.yml
	 
      ```
      repository_root: "http://12.1.1.1:7777/fileserver/wls"
      ```
      
	  The index.yml at the repository_root location should have a entry matching the weblogic server version and the corresponding release bits
      
	   ```---
          12.1.2: http://12.1.1.1:7001/fileserver/wls/wls1212_dev.zip
       ```
	   
   * Similarly, edit the repository_root of [oracle_jre.yml](config/oracle_jre.yml) to point to the location hosting the Oracle JRE binary.
   
     Sample `repository_root` for oracle_jre.yml
     
	  ```
       repository_root: "http://12.1.1.1:7777/fileserver/jdk"
	  ````

      The index.yml at the repository_root location should have a entry matching the jdk/jre version and the corresponding jdk binary file
     
	   ```---
          1.7.0_51: http://12.1.1.1:7001/fileserver/jdk/jre-7u51-linux-x64.tar.gz
       ```
* Cloud Foundry Release version
   * The Cloud Foundry Cloud Controller (cc) Nginx Engine defaults to a max payload size of 256MB. This setting is governed by the `client_max_body_size` parameter in the cc and ccng related properties of the cf manifest file.
   
     ```
	 
     properties:
       ...
       cc:
         app_events:
           cutoff_age_in_days: 31
         ....
         bulk_api_password: bulk-password
         `client_max_body_size: 256M`
       ....
       ccng:
         app_events:
           cutoff_age_in_days: 31
         app_usage_events:
           cutoff_age_in_days: 31
         ....
         bulk_api_password: bulk-password
         `client_max_body_size: 256M`
     
	 ```
	 
     The Cloud Foundry DEA droplet containing a zip of the full weblogic server, JDK/JRE binaries and app bits would exceed 520 MB in size. The `client_max_body_size` limit of 256M would limit the droplet transfer to Cloud Controller and failure during staging.
     The `client_max_body_size` attribute within the cf-manifest file should be updated to allow 750MB (or higher) depending on size of the application bits.
     * CF Releases prior to v159 used to hardcode the `client_max_body_size` to 256M. So, overriding it with the manifest entry wont work unless the bosh-lite or env has been updated to v159 or higher cf release.

* Application configuration
The buildpack looks for the presence of a `.wls` folder within the app at the root level as part of the detect call to proceed further.
Additional configurations and scripts packaged within this `.wls` folder would determine the resulting WebLogic Domain and services configuration generated by the buildpack.
   * Sample App structure

     Sample Web Application (WAR) structure
     ```
	 
              META-INF/
              META-INF/MANIFEST.MF
              WEB-INF/
              WEB-INF/lib/
              WEB-INF/web.xml
              WEB-INF/weblogic.xml
              index.jsp
              .wls/
              .wls/foreignjms/
              .wls/foreignjms/foreignJmsConfig1.yml
              .wls/jdbc/
              .wls/jdbc/jdbcDatasource1.yml
              .wls/jdbc/jdbcDatasource2.yml
              .wls/jms/
              .wls/jms/jmsConfig.yml
              .wls/jvm/
              .wls/jvm/jvmConfig.yml
              .wls/postJars/
              .wls/postJars/README.txt
              .wls/preJars/
              .wls/preJars/README.txt
              .wls/script/
              .wls/script/wlsDomainCreate.py
              .wls/security/
              .wls/security/securityConfig.yml
              .wls/wlsDomainConfig.yml
			  
       ```

   * Domain configuration (Required)
     The `.wls` folder should contain a single yaml file that contains information about the target domain, server name, user credentials etc.
     There is a sample [Domain config ](resources\wls\wlsDomainConfig.yml) bundled within the buildpack that can be used as a template to modify/extend the resulting domain.
	 
	 Refer to [domain](docs\domain_config.md) for more details.
	 
   * Scripts (Required)
     There can be a `script` folder within `.wls` with a Jython script file, for generating the domain
     There is a sample [Domain creation script](resources\wls\script\wlsDomainCreate.py) bundled within the buildpack that can be used as a template to modify/extend the resulting domain.
     
	 Refer to [script](docs\script.md) for more details.
	 
   * JVM related configuration (non-mandatory)
     There can be a `jvm` folder within `.wls` with a yaml file for JVM configuration to be applied to the server instance.
     There is a sample [JVM config](resources\wls\jvm\jvmConfig.yml) bundled within the buildpack that can be used as a template to modify/extend the resulting domain with additional datasources.
     
	 Refer to [jvm](docs\jvm.md) for more details.
	 
   * JDBC Datasources related configuration (non-mandatory)
     There can be a `jdbc` folder within `.wls` with multiple yaml files, each containing configuration relating to datasources (single or multi-pool).
     There is a sample [JDBC config](resources\wls\jdbc\jdbcDatasource1.yml) bundled within the buildpack that can be used as a template to modify/extend the resulting domain with additional datasources.
     
	 Refer to [jdbc](docs\jdbc.md) for more details.
	 
   * JMS Resources related configuration (non-mandatory)
     There can be a `jms` folder within `.wls` with a yaml file, containing configuration relating to jms resources
     There is a sample [JMS config](resources\wls\jms\jmsConfig.yml) bundled within the buildpack that can be used as a template to modify/extend the resulting domain with JMS Destinations/Connection Factories.
	 
	 Refer to [jms](docs\jms.md) for more details.
     	 
   * Foreign JMS Resources related configuration (non-mandatory)
     There can be a `foreignjms` folder within `.wls` with a yaml file, containing configuration relating to Foreign jms resources
     There is a sample [Foreign JMS config](resources\wls\foreignjms\foreignJmsConfig.yml) bundled within the buildpack that can be used as a template to modify/extend the resulting domain with Foreign JMS Services.
     	 
	 Refer to [foreignjms](docs\foreignjms.md) for more details.

   * Security Resources related configuration (non-mandatory)
     There can be a `security` folder within `.wls` with a yaml file, containing configuration relating to security configuration
     Add security related configurations as needed and update the domain creation script to use those configurations to modify/extend the resulting domain.
   	 
   * Pre and Post Jar folders (non-mandatory)
     The `preJars` folder within `.wls` can contain multiple jars or other resources, required to be loaded ahead of the WebLogic related jars. This can be useful for loading patches, debug jars, other resources that should override the bundled WebLogic jars.
     The `postJars` folder within `.wls` can contain multiple jars or other resources, required to be loaded after the WebLogic related jars. This can be useful for loading JDBC Drivers, Application dependencies or other resources as part of the server classpath.

   * Pre-existing Services bound to the Application
     * Services that are bound to the application via the Service Broker functionality would be used to configure and create related services in the WebLogic Domain.
       * The VCAP_SERVICES environment variable would be parsed to identify MySQL, PostGres services and create associated datasource configurations in the resulting domain.
       * The services can be either from [Pivotal Web Services Marketplace][] or [User Provided Services][] (like internal databases or services managed by internal Administrators and user applications just connect to it).



## Usage
To use this buildpack specify the URI of the repository when pushing an application to Cloud Foundry:

```
bash
cf push -b https://github.com/pivotal-cf/weblogic-buildpack
```

While working in sandbox env, its also possible to use a modified version of the buildpack without github repository using the zip format of the buildpack.
Note: Use zip to create the buildpack (rather than using jar) to ensure the detect, compile, release have execute permissions during the actual building of the app.

```
bash
cf create-buildpack java-buildpack-WLS java-buildpack-WLS.zip 1 --enable
```

## CF App Push
A domain would be created based on the configurations and script passed with the app by the buildpack on `cf push` command. The droplet containing the entire weblogic install, domain and application would be then executed as a droplet with the corresponding jvm variables, domain and services by Cloud Foundry. The application can then be scaled up or down using cf scale command. 

Note: Ensure `cf push` uses `-m` argument to specify a minimum process memory footprint of 1024 MB (1GB). Failure to do so will result in very small memory size for the DEA container and the jvm startup will fail.

Sample cf push: 

````
bash
cf push wlsSampleApp -m 1024M -p wlsSampleApp.war
```

## Examples

Refer to [WlsSampleApp](resources/wls/WlsSampleApp.war), a sample web application packaged with sample configurations under the resources/wls folder of the buildpack.

## Configuration and Extension
The buildpack supports configuration and extension through the use of Git repository forking.  The easiest way to accomplish this is to use [GitHub's forking functionality][] to create a copy of this repository.  Make the required configuration and extension changes in the copy of the repository.  Then specify the URL of the new repository when pushing Cloud Foundry applications.  If the modifications are generally applicable to the Cloud Foundry community, please submit a [pull request][] with the changes.

To learn how to configure various properties of the buildpack, follow the "Configuration" links below. More information on extending the buildpack is available [here](docs/extending.md).

## Contributing
[Pull requests][] are welcome; see the [contributor guidelines][] for details.

## License
This buildpack is released under version 2.0 of the [Apache License][].

[Apache License]: http://www.apache.org/licenses/LICENSE-2.0
[Cloud Foundry]: http://www.cloudfoundry.com
[contributor guidelines]: CONTRIBUTING.md
[GitHub's forking functionality]: https://help.github.com/articles/fork-a-repo
[Grails]: http://grails.org
[Groovy]: http://groovy.codehaus.org
[Installing Cloud Foundry on Vagrant]: http://blog.cloudfoundry.com/2013/06/27/installing-cloud-foundry-on-vagrant/
[Play Framework]: http://www.playframework.com
[pull request]: https://help.github.com/articles/using-pull-requests
[Pull requests]: http://help.github.com/send-pull-requests
[Spring Boot]: http://projects.spring.io/spring-boot/
[java-buildpack]: http://github.com/cloudfoundry/java-buildpack/
[WebLogic Application Server]: http://www.oracle.com/technetwork/middleware/weblogic/overview/index.html
[bosh-lite]: http://github.com/cloudfoundry/bosh-lite/
[Pivotal Web Services Marketplace]: http://docs.run.pivotal.io/marketplace/services/
[User Provided Services]: http://docs.run.pivotal.io/devguide/services/user-provided.html
=======
weblogic-buildpack
==================

weblogic buildpack that extends from the java-buildpack
>>>>>>> d530e237e73ea7cc41cc0d2e57baa2e11a830b40
